<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker入门 | java</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/java-note/images/myfavicon.png">
    <meta name="description" content="java 学习笔记">
    
    <link rel="preload" href="/java-note/assets/css/0.styles.f5140cd9.css" as="style"><link rel="preload" href="/java-note/assets/js/app.b4e76d81.js" as="script"><link rel="preload" href="/java-note/assets/js/2.af1aff5f.js" as="script"><link rel="preload" href="/java-note/assets/js/1.b527e11e.js" as="script"><link rel="preload" href="/java-note/assets/js/29.270a4d53.js" as="script"><link rel="prefetch" href="/java-note/assets/js/10.a284a5f0.js"><link rel="prefetch" href="/java-note/assets/js/11.63d78869.js"><link rel="prefetch" href="/java-note/assets/js/12.411148a2.js"><link rel="prefetch" href="/java-note/assets/js/13.a6d8e7b5.js"><link rel="prefetch" href="/java-note/assets/js/14.cde1b595.js"><link rel="prefetch" href="/java-note/assets/js/15.c815dbff.js"><link rel="prefetch" href="/java-note/assets/js/16.f89ca76d.js"><link rel="prefetch" href="/java-note/assets/js/17.b43ef999.js"><link rel="prefetch" href="/java-note/assets/js/18.f1ca2df4.js"><link rel="prefetch" href="/java-note/assets/js/19.d907bdbe.js"><link rel="prefetch" href="/java-note/assets/js/20.ba076c76.js"><link rel="prefetch" href="/java-note/assets/js/21.f7bf66e3.js"><link rel="prefetch" href="/java-note/assets/js/22.941a47dc.js"><link rel="prefetch" href="/java-note/assets/js/23.b9156e83.js"><link rel="prefetch" href="/java-note/assets/js/24.07b1cd92.js"><link rel="prefetch" href="/java-note/assets/js/25.5be29da5.js"><link rel="prefetch" href="/java-note/assets/js/26.2dd5fb9f.js"><link rel="prefetch" href="/java-note/assets/js/27.02358944.js"><link rel="prefetch" href="/java-note/assets/js/28.306847f8.js"><link rel="prefetch" href="/java-note/assets/js/3.313cba90.js"><link rel="prefetch" href="/java-note/assets/js/30.bfc6c248.js"><link rel="prefetch" href="/java-note/assets/js/31.fffd5f77.js"><link rel="prefetch" href="/java-note/assets/js/32.ac467fad.js"><link rel="prefetch" href="/java-note/assets/js/33.70479154.js"><link rel="prefetch" href="/java-note/assets/js/34.4e48aa0b.js"><link rel="prefetch" href="/java-note/assets/js/35.724f00a7.js"><link rel="prefetch" href="/java-note/assets/js/36.170daa7d.js"><link rel="prefetch" href="/java-note/assets/js/37.53f51c04.js"><link rel="prefetch" href="/java-note/assets/js/38.4e8ccf8d.js"><link rel="prefetch" href="/java-note/assets/js/39.4677e6bb.js"><link rel="prefetch" href="/java-note/assets/js/4.953ceea1.js"><link rel="prefetch" href="/java-note/assets/js/40.b55e76ef.js"><link rel="prefetch" href="/java-note/assets/js/41.fe541156.js"><link rel="prefetch" href="/java-note/assets/js/42.6f36570a.js"><link rel="prefetch" href="/java-note/assets/js/43.f7e4b8ba.js"><link rel="prefetch" href="/java-note/assets/js/44.668b7294.js"><link rel="prefetch" href="/java-note/assets/js/45.02de4e09.js"><link rel="prefetch" href="/java-note/assets/js/46.0b9a3a33.js"><link rel="prefetch" href="/java-note/assets/js/47.6978a7f4.js"><link rel="prefetch" href="/java-note/assets/js/48.036c9aa2.js"><link rel="prefetch" href="/java-note/assets/js/49.a77067f4.js"><link rel="prefetch" href="/java-note/assets/js/5.5d5d288a.js"><link rel="prefetch" href="/java-note/assets/js/50.50d9308b.js"><link rel="prefetch" href="/java-note/assets/js/51.f5490448.js"><link rel="prefetch" href="/java-note/assets/js/52.446d87e0.js"><link rel="prefetch" href="/java-note/assets/js/53.8779543f.js"><link rel="prefetch" href="/java-note/assets/js/54.94dc9f6f.js"><link rel="prefetch" href="/java-note/assets/js/55.8d7d0d45.js"><link rel="prefetch" href="/java-note/assets/js/56.69820a1b.js"><link rel="prefetch" href="/java-note/assets/js/57.fcaa4ea6.js"><link rel="prefetch" href="/java-note/assets/js/58.0fd49238.js"><link rel="prefetch" href="/java-note/assets/js/59.79c04a76.js"><link rel="prefetch" href="/java-note/assets/js/6.3c0fcba4.js"><link rel="prefetch" href="/java-note/assets/js/60.f35494a3.js"><link rel="prefetch" href="/java-note/assets/js/61.39888619.js"><link rel="prefetch" href="/java-note/assets/js/62.0d59237f.js"><link rel="prefetch" href="/java-note/assets/js/63.6d693cde.js"><link rel="prefetch" href="/java-note/assets/js/64.47d66d8e.js"><link rel="prefetch" href="/java-note/assets/js/65.fbcd58d8.js"><link rel="prefetch" href="/java-note/assets/js/66.962b42b1.js"><link rel="prefetch" href="/java-note/assets/js/67.563f535c.js"><link rel="prefetch" href="/java-note/assets/js/68.0c74e1c4.js"><link rel="prefetch" href="/java-note/assets/js/69.242f9577.js"><link rel="prefetch" href="/java-note/assets/js/7.93de78a3.js"><link rel="prefetch" href="/java-note/assets/js/70.3a3fb003.js"><link rel="prefetch" href="/java-note/assets/js/vendors~docsearch.d01c1f3f.js">
    <link rel="stylesheet" href="/java-note/assets/css/0.styles.f5140cd9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-note/" class="home-link router-link-active"><!----> <span class="site-name">java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>微服务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-note/Java/Java框架/微服务/微服务介绍.html" class="sidebar-link">微服务介绍</a></li><li><a href="/java-note/Java/Java框架/微服务/Docker入门.html" class="active sidebar-link">Docker入门</a></li><li><a href="/java-note/Java/Java框架/微服务/RabbitMQ入门.html" class="sidebar-link">RabbitMQ 入门</a></li><li><a href="/java-note/Java/Java框架/微服务/Elasticsearch入门.html" class="sidebar-link">Elasticsearch入门</a></li></ul></section></li><li><a href="/java-note/Java/Java框架/Kafka.html" class="sidebar-link">Kafka</a></li><li><a href="/java-note/Java/Java框架/SpringSecurity.html" class="sidebar-link">Spring Security</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>校园信息交流平台项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简易RPC框架项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内功</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>知识点自测速记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li><a href="#%E5%88%9D%E8%AF%86-docker">初识 Docker</a> <ul><li><a href="#docker-%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA">Docker 与虚拟机</a></li> <li><a href="#%E9%95%9C%E5%83%8F%E5%AE%B9%E5%99%A8%E4%BB%93%E5%BA%93">镜像、容器、仓库</a></li> <li><a href="#docker-%E6%9E%B6%E6%9E%84">Docker 架构</a></li></ul></li> <li><a href="#docker-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">Docker 基本操作</a> <ul><li><a href="#%E7%A4%BA%E4%BE%8B">示例</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%8D%B7">数据卷</a></li></ul></li> <li><a href="#dockerfile-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F">Dockerfile 自定义镜像</a> <ul><li><a href="#%E9%95%9C%E5%83%8F%E7%BB%93%E6%9E%84">镜像结构</a></li> <li><a href="#dockerfile">Dockerfile</a></li></ul></li> <li><a href="#dockercompose">DockerCompose</a> <ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-dockercompose">什么是 DockerCompose？</a></li> <li><a href="#dockercompose-%E5%AE%89%E8%A3%85">DockerCompose 安装</a></li> <li><a href="#dockercompose-%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9">DockerCompose 文件内容</a></li> <li><a href="#%E5%88%A9%E7%94%A8-dockercompose-%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4">利用 DockerCompose 部署微服务集群</a></li></ul></li> <li><a href="#docker-%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">Docker 镜像仓库</a> <ul><li><a href="#%E7%AE%80%E5%8C%96%E7%89%88%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">简化版镜像仓库</a></li> <li><a href="#%E5%B8%A6%E6%9C%89%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%89%88%E6%9C%AC">带有图形化界面版本</a></li> <li><a href="#%E5%9C%A8%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%8E%A8%E9%80%81%E6%88%96%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F">在私有镜像仓库推送或拉取镜像</a></li></ul></li></ul> <h2 id="初识-docker"><a href="#初识-docker" class="header-anchor">#</a> 初识 Docker</h2> <p>在大型项目中，组件往往较多，运行环境也较为复杂，部署时会碰到一些问题：</p> <ul><li>依赖关系复杂，容易出现兼容性问题</li> <li>开发、测试、生产环境有差异</li></ul> <p>Docker 是如何解决依赖关系复杂，容易出现兼容性问题的？</p> <ul><li>将应用的 Libs(函数库)、Deps(依赖)、配置与应用一起打包，形成可移植镜像</li> <li>将每个应用放到一个隔离容器去运行，避免互相干扰</li></ul> <p>Docker 是如何解决开发、测试、生产环境有差异的问题？</p> <ul><li>Docker 镜像中包含完整运行环境，包括系统函数库，仅依赖系统的 Linux 内核，因此可以在任意 Linux 操作系统上运行。</li></ul> <p>总的来说，Docker 是一个快速交付应用、运行应用的技术：</p> <ol><li>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意 Linux 操作系统。</li> <li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰。</li> <li>启动、移除都可以通过一行命令完成，方便快捷。</li></ol> <h3 id="docker-与虚拟机"><a href="#docker-与虚拟机" class="header-anchor">#</a> Docker 与虚拟机</h3> <p>虚拟机是在操作系统中模拟硬件设备，然后运行另一个操作系统，比如在 windows 系统中运行 Ubuntu 系统。</p> <div align="center"><img src="/java-note/assets/img/Docker结构.317cc1b4.png" width="50%"><img src="/java-note/assets/img/虚拟机结构.c1ce10c5.png" width="40%"></div> <p>两者对比：</p> <ul><li>性能：Docker 接近原生，虚拟机性能较差。</li> <li>硬盘占用：Docker 一般为 MB，虚拟机一般为 GB。</li> <li>启动：Docker 一般为秒级，虚拟机一般为分钟级。</li></ul> <h3 id="镜像、容器、仓库"><a href="#镜像、容器、仓库" class="header-anchor">#</a> 镜像、容器、仓库</h3> <p>镜像（Image）：Docker 将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。<br>
容器（Container）：镜像中的应用程序运行后形成的进程就是容器，只是 Docker 会给容器做隔离，对外不可见。<br>
仓库(Repository)：集中存放镜像的地方。DockerHub 就是这样一个 Docker 镜像的托管平台，类似的还有阿里云镜像服务，统称为 DockerRegistry。</p> <h3 id="docker-架构"><a href="#docker-架构" class="header-anchor">#</a> Docker 架构</h3> <p>Docker 是一个 CS 架构的程序，由两部分组成：</p> <ul><li>服务端（Server）：Docker 守护进程，负责处理 Docker 指令，管理镜像、容器等。</li> <li>客户端（Client）：通过命令或 RestAPI 向 Docker 服务端发送指令。可以在本地或远程向服务端发送指令。</li></ul> <h2 id="docker-基本操作"><a href="#docker-基本操作" class="header-anchor">#</a> Docker 基本操作</h2> <p>Doker 镜像名称一般分两部分组成：[repository]:[tag]，其中，tag 是指版本，在没有指定 tag 时，默认是 latest，代表最新版本的镜像。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> version          <span class="token comment"># 查看 docker 版本</span>
<span class="token function">docker</span> images           <span class="token comment"># 查看所有已下载镜像</span>
<span class="token function">docker</span> image <span class="token function">ls</span>         <span class="token comment"># 查看所有已下载镜像</span>
<span class="token function">docker</span> search mysql     <span class="token comment"># 查看 mysql 相关镜像</span>
<span class="token function">docker</span> pull mysql:5.7   <span class="token comment"># 拉取 mysql 镜像</span>
<span class="token function">docker</span> push <span class="token punctuation">[</span>image<span class="token punctuation">]</span>     <span class="token comment"># 推送镜像到 Registry</span>
<span class="token function">docker</span> build            <span class="token comment"># 构建镜像</span>
<span class="token function">docker</span> save             <span class="token comment"># 保存镜像为一个压缩包</span>
<span class="token function">docker</span> load             <span class="token comment"># 加载压缩包为镜像</span>
<span class="token function">docker</span> image prune      <span class="token comment"># 清理临时的、没有被使用的镜像文件</span>
<span class="token function">docker</span> rmi              <span class="token comment"># 删除镜像</span>

<span class="token function">docker</span> container <span class="token function">ls</span>     <span class="token comment"># 查看所有容器</span>
<span class="token function">docker</span> <span class="token function">ps</span>               <span class="token comment"># 查看正在运行的容器</span>
<span class="token function">docker</span> logs             <span class="token comment"># 查看容器运行日志，-f 参数可以持续查看日志</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span>             <span class="token comment"># 进入容器执行命令</span>
<span class="token function">docker</span> run              <span class="token comment"># 将一个镜像启动为容器</span>
<span class="token function">docker</span> pause            <span class="token comment"># 暂停容器</span>
<span class="token function">docker</span> unpause          <span class="token comment"># 将暂停的容器启动</span>
<span class="token function">docker</span> start            <span class="token comment"># 启动容器</span>
<span class="token function">docker</span> stop             <span class="token comment"># 停止容器</span>
<span class="token function">docker</span> <span class="token function">rm</span>               <span class="token comment"># 删除指定容器，不能删除运行中的容器，除非添加 -f</span>
</code></pre></div><h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> containerName <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token parameter variable">-d</span> nginx
</code></pre></div><p>参数解读：</p> <ul><li><code>--name</code>：给容器起一个名字</li> <li><code>-p</code>：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右侧是容器端口</li> <li><code>-d</code>：在后台运行容器，一般都要添加</li> <li><code>nginx</code>：镜像名称</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mn <span class="token function">bash</span> 
</code></pre></div><p>参数解读：</p> <ul><li><code>-it</code>：给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互</li> <li><code>mn</code>：要进入的容器的名称</li> <li><code>bash</code>：进入容器后执行的命令，bash 是一个 Linux 终端交互命令</li></ul> <blockquote><p>exec 命令可以进入容器修改文件，但是在容器内修改文件是不推荐的。</p></blockquote> <h3 id="数据卷"><a href="#数据卷" class="header-anchor">#</a> 数据卷</h3> <p>为什么需要用到数据卷？原来的容器使用方式有什么问题？</p> <ol><li>不便于修改：当我们要修改容器内的某些数据时，需要进入容器内部修改，很不方便。</li> <li>数据不可复用：在容器内的修改对外是不可见的。所有修改对新创建的容器是不可复用的。</li> <li>升级维护困难：数据在容器内，如果要升级容器必然删除旧容器，所有数据都跟着删除了。</li></ol> <p>数据卷（volume）是一个虚拟目录，指向宿主机文件系统中的某个目录，它是由 Docker 进行管理的。当我们把数据卷挂载到容器内的某个目录后，我们在数据卷中做的修改都能够实时同步到容器中。</p> <p>数据卷操作的基本语法如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> volume <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span>
</code></pre></div><p><code>docker volume</code> 命令是数据卷操作，根据命令后跟随的 <code>COMMAND</code> 来确定下一步的操作：</p> <ul><li><code>create</code>：创建一个 volume。</li> <li><code>inspect</code>：显示一个或多个 volume 的信息。</li> <li><code>ls</code>：列出所有的 volume。</li> <li><code>prune</code>：删除未使用的 volume。</li> <li><code>rm</code>：删除一个或多个指定的 volume。</li></ul> <p>在创建容器时，可以通过 <code>-v</code> 参数来挂载一个数据卷到某个容器目录</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
  <span class="token parameter variable">-name</span> mn <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> html:/root/html <span class="token punctuation">\</span>    <span class="token comment"># 把 html 数据卷挂载到容器内的 /root/html 这个目录</span>
  <span class="token parameter variable">-p</span> <span class="token number">8080</span>:80 <span class="token punctuation">\</span> 
  nginx
</code></pre></div><p>此外，想要实现跟数据卷一样的功能，也可以直接将宿主机目录直接挂载到容器，其挂载的语法跟语句卷挂载是类似的：</p> <ul><li><code>-v [宿主机目录]:[容器内目录]</code></li> <li><code>-v [宿主机文件]:[容器内文件]</code></li></ul> <p>数据卷挂载和目录直接挂载的区别如下：</p> <ol><li>数据卷挂载耦合度低，由 docker 来管理目录，但是目录较深，不好找</li> <li>目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看</li></ol> <h2 id="dockerfile-自定义镜像"><a href="#dockerfile-自定义镜像" class="header-anchor">#</a> Dockerfile 自定义镜像</h2> <h3 id="镜像结构"><a href="#镜像结构" class="header-anchor">#</a> 镜像结构</h3> <p>要自定义镜像，首先肯定要先了解镜像结构。<br>
前面说过，镜像是将应用程序及其需要的系统函数库、环境配置、依赖打包而成。而它的结构是分层的，每一层称为一个 Layer。</p> <ul><li>BaseImage：应用依赖的系统函数库、环境、配置、文件等，因为基本都不会变，所以打包成一个基础镜像层。</li> <li>其他层：在 BaseImage 基础上添加安装包、依赖、配置等，每次操作都形成新的一层。</li> <li>入口（Entrypoint）：镜像运行入口，一般是程序启动的命令、脚本和参数。</li></ul> <h3 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h3> <p>Dockerfile 就是一个文本文件，其中包含一个个的指令，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层 Layer。
</p><div align="center"><img src="/java-note/assets/img/Dockerfile指令.4e785835.png" width="100%"></div><p></p> <p>Dockerfile 文件示例：</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token comment"># 指定基础镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> ubuntu:16.04</span>
<span class="token comment"># 配置环境变量，JDK的安装目录</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_DIR=/usr/local</span>

<span class="token comment"># 拷贝jdk和java项目的包</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./docker-demo.jar /tmp/app.jar</span>

<span class="token comment"># 安装JDK</span>
<span class="token instruction"><span class="token keyword">RUN</span> cd <span class="token variable">$JAVA_DIR</span> <span class="token operator">\</span>
 &amp;&amp; tar -xf ./jdk8.tar.gz <span class="token operator">\</span>
 &amp;&amp; mv ./jdk1.8.0_144 ./java8</span>

<span class="token comment"># 配置环境变量</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME=<span class="token variable">$JAVA_DIR</span>/java8</span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span>/bin</span>

<span class="token comment"># 暴露端口</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8090</span>
<span class="token comment"># 入口，java项目的启动命令</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> java -jar /tmp/app.jar</span>
</code></pre></div><p>注意：Dockerfile 的第一行必须是 FROM，从一个基础镜像来构建，基础镜像可以是基本操作系统，如 Ubuntu，也可以是其他人制作好的镜像，如 java:8-alpine。</p> <p>在编写好 dockerfile 后，可以使用 <code>docker build</code> 命令来构建镜像，以及使用 <code>docker run</code> 创建容器并运行。</p> <h2 id="dockercompose"><a href="#dockercompose" class="header-anchor">#</a> DockerCompose</h2> <h3 id="什么是-dockercompose"><a href="#什么是-dockercompose" class="header-anchor">#</a> 什么是 DockerCompose？</h3> <ul><li>Docker Compose 可以基于 Compose 文件帮我们快速的部署分布式应用，而无需手动一个个创建和运行容器。</li> <li>Docker Compose 本质也是一个文本文件，通过指令定义集群中的每个容器如何运行。</li></ul> <h3 id="dockercompose-安装"><a href="#dockercompose-安装" class="header-anchor">#</a> DockerCompose 安装</h3> <ol><li>要使用 DockerCompose 需要先安装，在 Linux 下可以通过命令安装:</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 安装</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/docker/compose/releases/download/1.29.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
</code></pre></div><ol start="2"><li>修改文件权限：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 修改权限</span>
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div><ol start="3"><li>Base 自动补全命令</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 补全命令</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre></div><h3 id="dockercompose-文件内容"><a href="#dockercompose-文件内容" class="header-anchor">#</a> DockerCompose 文件内容</h3> <p>DockerCompose 和 Dockerfile 文件的内容是一一对应的，只是语法结构不一样。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.2&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>           <span class="token comment"># 各种微服务</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos/nacos<span class="token punctuation">-</span>server   <span class="token comment"># nacos 微服务镜像</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MODE</span><span class="token punctuation">:</span> standalone          <span class="token comment"># nacos 模式：单机</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8848:8848&quot;</span>             <span class="token comment"># 容器内外端口映射</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.25
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                    <span class="token comment"># 数据卷挂载</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;$PWD/mysql/data:/var/lib/mysql&quot;</span>    
      <span class="token punctuation">-</span> <span class="token string">&quot;$PWD/mysql/conf:/etc/mysql/conf.d/&quot;</span>
  <span class="token key atrule">userservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./user<span class="token punctuation">-</span>service       <span class="token comment"># 会在这个目录下找 Dockerfile 构建镜像</span>
  <span class="token key atrule">orderservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./order<span class="token punctuation">-</span>service
  <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./gateway
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;10010:10010&quot;</span>
</code></pre></div><h3 id="利用-dockercompose-部署微服务集群"><a href="#利用-dockercompose-部署微服务集群" class="header-anchor">#</a> 利用 DockerCompose 部署微服务集群</h3> <ol><li>编写好 DockerCompose 文件，我们要对哪些微服务做部署要在文件中写好。</li> <li>修改自己的微服务项目，将数据库、Nacos 地址等都命名为 DockerCompose 中的服务名。</li> <li>将各个微服务编译好打包成 jar 包，拷贝到它们在微服务集群中对应的子目录中，jar 包名字要与子目录中的 Dockerfile 对应。</li> <li>将微服务集群文件夹上传至虚拟机，利用 <code>docker-compose up -d</code> 来部署。</li></ol> <h2 id="docker-镜像仓库"><a href="#docker-镜像仓库" class="header-anchor">#</a> Docker 镜像仓库</h2> <p>镜像仓库（Docker Registry）有公共的和私有的两种形式：</p> <ul><li>公共仓库：例如 Docker 官方的 DockerHub，国内也有一些云服务商提供类似于 Docker Hub 的公开服务，比如网易云镜像服务，DaoCloud 镜像服务，阿里云镜像服务等。</li> <li>私有仓库：除了使用公开仓库外，用户还可以在本地搭建私有 Docker Registry。企业自己的镜像最好是采用私有 Docker Registry 来实现。</li></ul> <h3 id="简化版镜像仓库"><a href="#简化版镜像仓库" class="header-anchor">#</a> 简化版镜像仓库</h3> <p>Docker 官方的 Docker Registry 是一个基础版本的 Docker 镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。搭建方式比较简单，命令如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
    <span class="token parameter variable">--name</span> registry	<span class="token punctuation">\</span>
    <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> registry-data:/var/lib/registry <span class="token punctuation">\</span>
    registry
</code></pre></div><p>命令中挂载了一个数据卷 registry-data 到容器内的 /var/lib/registry  目录，这是私有镜像库存放数据的目录。</p> <p>访问 http://YourIp:5000/v2/_catalog 可以查看当前私有镜像服务中包含的镜像。</p> <h3 id="带有图形化界面版本"><a href="#带有图形化界面版本" class="header-anchor">#</a> 带有图形化界面版本</h3> <p>使用 DockerCompose 部署带有图形界面的 DockerRegistry，命令如下：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.0'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./registry<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/registry
  <span class="token key atrule">ui</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> joxit/docker<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>ui<span class="token punctuation">:</span>static
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> REGISTRY_TITLE=传智教育私有仓库
      <span class="token punctuation">-</span> REGISTRY_URL=http<span class="token punctuation">:</span>//registry<span class="token punctuation">:</span><span class="token number">5000</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> registry
</code></pre></div><h3 id="在私有镜像仓库推送或拉取镜像"><a href="#在私有镜像仓库推送或拉取镜像" class="header-anchor">#</a> 在私有镜像仓库推送或拉取镜像</h3> <p>推送镜像到私有镜像服务必须先 tag，步骤如下：</p> <ol><li>重新命名本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> tag nginx:latest <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div><ol start="2"><li>推送镜像</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> push <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div><ol start="3"><li>拉取镜像</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> pull <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-note/Java/Java框架/微服务/微服务介绍.html" class="prev">
        微服务介绍
      </a></span> <span class="next"><a href="/java-note/Java/Java框架/微服务/RabbitMQ入门.html">
        RabbitMQ 入门
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/java-note/assets/js/app.b4e76d81.js" defer></script><script src="/java-note/assets/js/2.af1aff5f.js" defer></script><script src="/java-note/assets/js/1.b527e11e.js" defer></script><script src="/java-note/assets/js/29.270a4d53.js" defer></script>
  </body>
</html>
