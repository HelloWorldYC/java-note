<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目总体 | java</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/java-note/images/myfavicon.png">
    <meta name="description" content="java 学习笔记">
    
    <link rel="preload" href="/java-note/assets/css/0.styles.708fcbbf.css" as="style"><link rel="preload" href="/java-note/assets/js/app.4802240e.js" as="script"><link rel="preload" href="/java-note/assets/js/2.834e1286.js" as="script"><link rel="preload" href="/java-note/assets/js/1.56911593.js" as="script"><link rel="preload" href="/java-note/assets/js/48.4ae8f2d5.js" as="script"><link rel="prefetch" href="/java-note/assets/js/10.7f863a77.js"><link rel="prefetch" href="/java-note/assets/js/11.6b66a110.js"><link rel="prefetch" href="/java-note/assets/js/12.8440333d.js"><link rel="prefetch" href="/java-note/assets/js/13.1f1fe7b4.js"><link rel="prefetch" href="/java-note/assets/js/14.65ef5a04.js"><link rel="prefetch" href="/java-note/assets/js/15.f60694df.js"><link rel="prefetch" href="/java-note/assets/js/16.efadbd73.js"><link rel="prefetch" href="/java-note/assets/js/17.d9390df8.js"><link rel="prefetch" href="/java-note/assets/js/18.2f93832a.js"><link rel="prefetch" href="/java-note/assets/js/19.e21d8298.js"><link rel="prefetch" href="/java-note/assets/js/20.c801663f.js"><link rel="prefetch" href="/java-note/assets/js/21.ed1b35e4.js"><link rel="prefetch" href="/java-note/assets/js/22.33b69923.js"><link rel="prefetch" href="/java-note/assets/js/23.d0cb6ea3.js"><link rel="prefetch" href="/java-note/assets/js/24.77c390b0.js"><link rel="prefetch" href="/java-note/assets/js/25.93636fbb.js"><link rel="prefetch" href="/java-note/assets/js/26.17ffe540.js"><link rel="prefetch" href="/java-note/assets/js/27.903242ff.js"><link rel="prefetch" href="/java-note/assets/js/28.dc5daf82.js"><link rel="prefetch" href="/java-note/assets/js/29.95e7dd6e.js"><link rel="prefetch" href="/java-note/assets/js/3.5c83221f.js"><link rel="prefetch" href="/java-note/assets/js/30.ab86d2f2.js"><link rel="prefetch" href="/java-note/assets/js/31.bb5e7344.js"><link rel="prefetch" href="/java-note/assets/js/32.a33b149c.js"><link rel="prefetch" href="/java-note/assets/js/33.e5f25c3c.js"><link rel="prefetch" href="/java-note/assets/js/34.30d8a274.js"><link rel="prefetch" href="/java-note/assets/js/35.5d8fa2f0.js"><link rel="prefetch" href="/java-note/assets/js/36.1e873df7.js"><link rel="prefetch" href="/java-note/assets/js/37.594daa95.js"><link rel="prefetch" href="/java-note/assets/js/38.bc0467b7.js"><link rel="prefetch" href="/java-note/assets/js/39.dd90bf94.js"><link rel="prefetch" href="/java-note/assets/js/4.f186242d.js"><link rel="prefetch" href="/java-note/assets/js/40.70522d96.js"><link rel="prefetch" href="/java-note/assets/js/41.1f09c6b9.js"><link rel="prefetch" href="/java-note/assets/js/42.49f51f5c.js"><link rel="prefetch" href="/java-note/assets/js/43.29326b6e.js"><link rel="prefetch" href="/java-note/assets/js/44.8408958a.js"><link rel="prefetch" href="/java-note/assets/js/45.a061f8ad.js"><link rel="prefetch" href="/java-note/assets/js/46.7b5df9fc.js"><link rel="prefetch" href="/java-note/assets/js/47.990d3a28.js"><link rel="prefetch" href="/java-note/assets/js/49.880752cc.js"><link rel="prefetch" href="/java-note/assets/js/5.377eaaa7.js"><link rel="prefetch" href="/java-note/assets/js/50.a0ba8023.js"><link rel="prefetch" href="/java-note/assets/js/51.34976563.js"><link rel="prefetch" href="/java-note/assets/js/52.23629959.js"><link rel="prefetch" href="/java-note/assets/js/53.8ad3e7eb.js"><link rel="prefetch" href="/java-note/assets/js/54.018f6f49.js"><link rel="prefetch" href="/java-note/assets/js/55.f7b9ff66.js"><link rel="prefetch" href="/java-note/assets/js/56.c1a1091c.js"><link rel="prefetch" href="/java-note/assets/js/57.a314e87a.js"><link rel="prefetch" href="/java-note/assets/js/58.b3b40ad4.js"><link rel="prefetch" href="/java-note/assets/js/59.6ca124ae.js"><link rel="prefetch" href="/java-note/assets/js/6.d127c244.js"><link rel="prefetch" href="/java-note/assets/js/60.62927391.js"><link rel="prefetch" href="/java-note/assets/js/61.9f3ed6b5.js"><link rel="prefetch" href="/java-note/assets/js/62.186bc77d.js"><link rel="prefetch" href="/java-note/assets/js/63.75fdcace.js"><link rel="prefetch" href="/java-note/assets/js/64.e3d406b8.js"><link rel="prefetch" href="/java-note/assets/js/65.b6b92143.js"><link rel="prefetch" href="/java-note/assets/js/66.a832b085.js"><link rel="prefetch" href="/java-note/assets/js/67.a165eb09.js"><link rel="prefetch" href="/java-note/assets/js/68.b710e3a6.js"><link rel="prefetch" href="/java-note/assets/js/69.8d29ae2a.js"><link rel="prefetch" href="/java-note/assets/js/7.8472e88f.js"><link rel="prefetch" href="/java-note/assets/js/70.25a2b7b3.js"><link rel="prefetch" href="/java-note/assets/js/71.fe7a34d2.js"><link rel="prefetch" href="/java-note/assets/js/vendors~docsearch.3f62eedb.js">
    <link rel="stylesheet" href="/java-note/assets/css/0.styles.708fcbbf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-note/" class="home-link router-link-active"><!----> <span class="site-name">java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>校园信息交流平台项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-note/Java/校园信息交流平台项目/项目总体.html" class="active sidebar-link">项目总体</a></li><li><a href="/java-note/Java/校园信息交流平台项目/项目细节.html" class="sidebar-link">项目细节</a></li><li><a href="/java-note/Java/校园信息交流平台项目/项目问题及解决.html" class="sidebar-link">项目问题及解决</a></li><li><a href="/java-note/Java/校园信息交流平台项目/项目常见面试题.html" class="sidebar-link">项目常见面试题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简易RPC框架项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内功</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>知识点自测速记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="开发平台首页"><a href="#开发平台首页" class="header-anchor">#</a> 开发平台首页</h3> <ul><li>开发平台首页，显示前十个帖子
<ul><li>生成实体类对应discuss_post表，并将其对应dao层完成
<ul><li>分页查询，若需查某一个id的评论，则userId动态加入sql</li> <li>查询所有评论数，若需查某一个id的所有评论数，则加入动态sql</li></ul></li></ul></li> <li>开发分页组件，分页显示所有帖子</li></ul> <h3 id="开发平台登录模块"><a href="#开发平台登录模块" class="header-anchor">#</a> 开发平台登录模块</h3> <h4 id="发送邮件"><a href="#发送邮件" class="header-anchor">#</a> 发送邮件</h4> <ul><li>邮箱设置
<ul><li>启用客户端SMTP服务</li></ul></li> <li>功能开发
<ul><li>导入jar包</li> <li>邮箱参数配置</li> <li>使用JavaMailSender发送邮件</li></ul></li> <li>模板引擎
<ul><li>使用 Thymeleaf 发送HTML邮件</li></ul></li></ul> <h4 id="开发注册功能"><a href="#开发注册功能" class="header-anchor">#</a> 开发注册功能</h4> <ul><li>访问注册页面，Controller 层定义 <code>getRegisterPage</code> 方法，返回登录页面 register.html</li> <li>导入 commons lang 包</li> <li>在 application.properties 文件中配置网站域名，便于后面激活邮件中的激活地址能访问服务器</li> <li>在util包中定义一个工具类 CommunityUtil，提供静态方法：
<ul><li>生成随机字符串：利用Java自带的UUID工具包，其中生成的随机字符串中包含 <code>&quot;-&quot;</code>，要将其替换为空字符串</li> <li>MD5加密：给密码进行MD5加密，此外，为了更安全，在加密前明文密码中加入盐 <code>salt</code>，即 <code>hello -&gt; hello + 3e4a8</code>，再进行MD5加密，这一步不在该方法中实现。</li></ul></li> <li>在 UserService 中定义注册方法，返回的是一个map对象
<ul><li>空值处理，包括对象本身，账号，密码等</li> <li>验证账号是否已被注册，邮箱是否被注册</li> <li>生成5位随机字符串作为 <code>salt</code> ，加到明文密码中，再进行 md5 加密</li> <li>对用户类型，状态，激活码进行设置，同时随机赋给一个头像 <code>http://images.nowcoder.com/head/%dt.png</code>，<code>%d</code>属于 1~1000，创建的时间也进行设置</li> <li>在 activation.html 中修改激活邮件模板</li> <li>发送激活邮件：利用 <code>context</code> 容器存储注册用户的账号以及存储用户要通过邮箱获取的激活路径，用模板引擎生成格式化的模板，并通过 <code>mailClient</code> 发送邮件</li></ul></li> <li>在 loginController 中定义Post请求的处理方法，传入的是 Model 和 账号，密码，邮箱（可以封装为 User 对象）
<ul><li>通过 UserService 调用 register 方法，根据返回的 Map 确定要怎么处理请求，若为 <code>null</code> 说明注册成功，返回到处理结果页面 operate-result.html。若注册不成功，则返回注册页面，同时要将注册失败的信息存储到model中，以在注册页面中显示。</li></ul></li> <li>在 register.html 中提交表单需要定义 name 属性，要跟接收类 User 的属性对应。同时，由于该页面也要复用，因此要对注册失败信息判断是否显示。若判断需要显示，则原来输入的账号密码等还要显示。</li> <li>账号激活处理
<ul><li>在 util 中定义常量接口，定义一些状态，在这里要定义的是激活的三个结果状态：成功、重复激活、失败。</li> <li>在 UserService 中定义激活方法，如果 userId 对应的激活码对应上的话，就激活。</li> <li>在 loginController 中定义激活请求处理
<ul><li>调用激活方法并返回结果，根据结果处理请求。无论激活是否成功，都返回到处理结果页面 operate-result.html，不同的是携带的信息不一样。</li></ul></li> <li>定义登录页面</li></ul></li></ul> <h4 id="生成验证码"><a href="#生成验证码" class="header-anchor">#</a> 生成验证码</h4> <ul><li>导入 Kaptcha 的 jar 包</li> <li>编写 Kaptcha 配置类
<ul><li>Kaptcha 核心是一个实现类 Kaptcha，有一个默认实现类 DefaultKaptcha，其主要利用方法 <code>setConfig()</code> 进行配置，而 <code>setConfig()</code> 需要一个 <code>Config</code> 对象，而 <code>Config</code> 对象需要传入 <code>Properties</code> 对象</li> <li>进行配置，设置图片长宽高、文字的字体颜色、文字候选、文字长度、采用的噪声类。</li></ul></li> <li>生成随机字符、生成图片，通过 response 输出流将图片输出出去。</li> <li>在 login.html 中通过 js 动态地改变验证码，即每次刷新都能访问图片。</li></ul> <h4 id="开发登录、退出功能"><a href="#开发登录、退出功能" class="header-anchor">#</a> 开发登录、退出功能</h4> <ul><li>访问登录页面
<ul><li>点击顶部区域内的链接，打开登录页面</li> <li>定义实体类，与 login_ticket 表对应，以及定义它的 mapper ，</li></ul></li> <li>登录
<ul><li>验证账号、密码、验证码。成功时，生成登录凭证，发放给客户端；失败时，跳转回登录页。</li> <li>在 UserService 中定义登录方法，返回 map 集合，因为处理的结果有多种
<ul><li>对空值进行处理</li> <li>验证账号及其状态，确认库中是否有该账号，以及判断该账号的状态是否激活了</li> <li>验证密码，要将传入的明文密码先加密了再与库中的进行比较</li> <li>登录成功，则生成登录凭证</li></ul></li> <li>在 loginController 中定义登录请求方法
<ul><li>检查验证码</li> <li>检查账号密码</li></ul></li></ul></li> <li>退出
<ul><li>将登录凭证修改为失效状态。</li> <li>跳转至网站首页。</li></ul></li></ul> <h4 id="显示登录信息"><a href="#显示登录信息" class="header-anchor">#</a> 显示登录信息</h4> <ul><li>通过设置拦截器来实现
<ul><li>从cookie中获取凭证</li> <li>如果凭证不为空则查询凭证，检查凭证是否有效，若有效根据凭证查询用户</li></ul></li> <li>在请求开始时查询登录用户</li> <li>在本次请求中持有用户数据</li> <li>在模板视图上显示用户数据</li> <li>在请求结束时清理用户数据</li></ul> <h4 id="账号设置"><a href="#账号设置" class="header-anchor">#</a> 账号设置</h4> <ul><li>上传文件
<ul><li>请求：必须是POST请求</li> <li>表单：enctype=&quot;multipart/form-data&quot;</li> <li>spring MVC:通过 MultipartFile 处理上传文件</li> <li>开发步骤：
<ul><li>访问账号设置页面</li> <li>上传头像</li> <li>获取头像</li></ul></li></ul></li></ul> <h4 id="检查登录状态"><a href="#检查登录状态" class="header-anchor">#</a> 检查登录状态</h4> <ul><li>使用拦截器
<ul><li>在方法前标注自定义注解</li> <li>拦截所有请求，只处理带有该注解的方法</li></ul></li> <li>自定义注解(通过元注解定义)
<ul><li>常用的元注解： <code>@Target</code>、<code>@Retention</code>、<code>@Document</code>、<code>@Inherited</code></li> <li>如何读取注解：<code>Method.getDeclaredAnnotations()</code>、<code>Method.getAnnotation(Class&lt;T&gt; annotationClass)</code></li></ul></li></ul> <h3 id="平台核心模块"><a href="#平台核心模块" class="header-anchor">#</a> 平台核心模块</h3> <h4 id="过滤敏感词"><a href="#过滤敏感词" class="header-anchor">#</a> 过滤敏感词</h4> <ul><li>前缀树
<ul><li>名称：Trie、字典树、查找树</li> <li>特点：查找效率高，消耗内存大</li> <li>应用：字符串检索、词频统计、字符串排序等</li></ul></li> <li>敏感词过滤器
<ul><li>定义前缀树</li> <li>根据敏感词，初始化前缀树</li> <li>编写过滤敏感词的方法</li></ul></li></ul> <h4 id="发布帖子"><a href="#发布帖子" class="header-anchor">#</a> 发布帖子</h4> <ul><li>AJAX
<ul><li>Asynchronous JavaScript and XML</li> <li>异步的JavaScript与XML，不是一门新技术，只是一个新的术语</li> <li>使用AJAX，网页能够将增量更新呈现在页面上，而不需要刷新整个页面</li> <li>虽然X代表XML，但目前JSON的使用比XML更加普遍</li></ul></li> <li>采用AJAX请求，实现发布帖子的功能</li></ul> <h4 id="帖子详情"><a href="#帖子详情" class="header-anchor">#</a> 帖子详情</h4> <ul><li>DiscussPostMapper</li> <li>DiscussPostService</li> <li>DiscussPostController</li> <li>index.html
<ul><li>在帖子标题上增加访问详情页面的链接</li></ul></li> <li>discuss-detail.html
<ul><li>处理静态资源的访问路径</li> <li>复用index.html的header区域</li> <li>显示标题、作者、发布时间、帖子正文等内容</li></ul></li></ul> <h4 id="显示评论"><a href="#显示评论" class="header-anchor">#</a> 显示评论</h4> <ul><li>数据层
<ul><li>根据实体查询一页评论数据</li> <li>根据实体查询评论的数量</li></ul></li> <li>业务层
<ul><li>处理查询评论的业务</li> <li>处理查询评论数量的业务</li></ul></li> <li>表现层
<ul><li>显示帖子详情数据时，同时显示该帖子所有的评论数据</li></ul></li></ul> <h4 id="添加评论"><a href="#添加评论" class="header-anchor">#</a> 添加评论</h4> <ul><li>数据层
<ul><li>增加评论数据</li> <li>修改帖子的评论数量</li></ul></li> <li>业务层
<ul><li>处理添加评论的业务</li> <li>先增加评论，再更新帖子的评论数量</li></ul></li> <li>表现层
<ul><li>处理添加评论数据的请求</li> <li>设置添加评论的表单</li></ul></li></ul> <h4 id="私信列表"><a href="#私信列表" class="header-anchor">#</a> 私信列表</h4> <ul><li>私信列表
<ul><li>查询当前用户的会话列表</li> <li>每个会话只显示一条最新的私信</li> <li>支持分页显示</li></ul></li> <li>私信详情
<ul><li>查询某个会话所包含的私信</li> <li>支持分页显示</li></ul></li></ul> <h4 id="发送私信"><a href="#发送私信" class="header-anchor">#</a> 发送私信</h4> <ul><li>发送私信
<ul><li>采用异步的方式发送私信</li> <li>发送成功后输信私信列表</li></ul></li> <li>设置已读
<ul><li>访问私信详情时，将显示的私信设置为已读状态</li></ul></li></ul> <h4 id="统一处理异常"><a href="#统一处理异常" class="header-anchor">#</a> 统一处理异常</h4> <ul><li>@ControllerAdvice
<ul><li>用于修饰类，表示该类是Controller的全局配置类。</li> <li>在此类中，可以对Controller进行如下三种全局配置：异常处理方案、绑定数据方案、绑定参数方案。</li></ul></li> <li>@ExceptionHandler
<ul><li>用于修饰方法，该方法会在Controller出现异常后被调用，用于处理捕获到的异常。</li></ul></li> <li>@ModelAttribute
<ul><li>用于修饰方法，该方法会在Controller方法执行前被调用，用于为Model对象绑定参数。</li></ul></li> <li>@DataBinder
<ul><li>用于修饰方法，该方法会在Controller方法执行前被调用，用于绑定参数的转换器。</li></ul></li></ul> <h4 id="统一记录日志"><a href="#统一记录日志" class="header-anchor">#</a> 统一记录日志</h4> <ul><li>AOP的概念
<ul><li>Aspect Oriented Programing，即面向方面（切面）编程</li> <li>AOP是一种编程思想，是对OOP的补充，可以进一步提高编程的效率。</li></ul></li> <li>AOP的实现
<ul><li>AspectJ
<ul><li>AspectJ是语言级的实现，它扩展了Java语言，定义了AOP语法。</li> <li>AspectJ在编译期织入代码，它有一个专门的编译器，用来生成遵守Java字节码规范的class文件。</li></ul></li> <li>Spring AOP
<ul><li>Spring AOP使用纯Java实现，它不需要专门的编译过程，也不需要特殊的类装载器。</li> <li>Spring AOP在运行时通过代理的方式织入代码，只支持方法类型的连接点</li> <li>Spring支持对AspectJ的集成。</li></ul></li></ul></li> <li>Spring AOP
<ul><li>JDK动态代理
<ul><li>Java提供的动态代理技术，可以在运行时创建接口的代理实例。</li> <li>Spring AOP默认采用此种方式，在接口的代理实例中织入代码。</li></ul></li> <li>CGLib动态代理
<ul><li>采用底层的字节码技术，在运行时创建子类代理实例。</li> <li>当目标对象不存在接口时，Spring AOP会采用此种方式，在子类实例中织入代码</li></ul></li></ul></li></ul> <h3 id="redis-一站式高性能存储方案"><a href="#redis-一站式高性能存储方案" class="header-anchor">#</a> Redis，一站式高性能存储方案</h3> <h4 id="点赞"><a href="#点赞" class="header-anchor">#</a> 点赞</h4> <ul><li>点赞
<ul><li>支持对帖子、评论点赞，赞帖子同时会给帖子的主人点赞</li> <li>第1次点赞，第2次取消点赞</li></ul></li> <li>首页点赞数量
<ul><li>统计帖子的点赞数量</li></ul></li> <li>详情页点赞数量
<ul><li>统计点赞数量</li> <li>显示点赞状态</li></ul></li></ul> <h4 id="我收到的赞"><a href="#我收到的赞" class="header-anchor">#</a> 我收到的赞</h4> <ul><li>重构点赞功能
<ul><li>以用户为key，记录点赞数量</li> <li>increment(key),decrement(key)</li></ul></li> <li>开发个人主页
<ul><li>以用户为key，查询点赞数量</li></ul></li></ul> <h4 id="关注、取消关注"><a href="#关注、取消关注" class="header-anchor">#</a> 关注、取消关注</h4> <ul><li>需求
<ul><li>开发关注、取消关注功能</li> <li>统计用户的关注数、粉丝数</li></ul></li> <li>关键
<ul><li>若A关注了B，则A是B的Follower(粉丝)，B是A的Followee(关注目标)</li> <li>关注的目标可以是用户、帖子、题目等，在实现时将这些目标抽象为实体</li></ul></li></ul> <h4 id="关注列表、粉丝列表"><a href="#关注列表、粉丝列表" class="header-anchor">#</a> 关注列表、粉丝列表</h4> <ul><li>业务层
<ul><li>查询某个用户关注的人，支持分页</li> <li>查询某个用户的粉丝，支持分页</li></ul></li> <li>表现层
<ul><li>处理“查询关注的人”、“查询粉丝”请求</li> <li>编写“查询关注的人”、“查询粉丝”模板</li></ul></li></ul> <h4 id="优化登录模块"><a href="#优化登录模块" class="header-anchor">#</a> 优化登录模块</h4> <ul><li>使用Redis存储验证码
<ul><li>验证码需要频繁的访问与刷新，对性能要求较高</li> <li>验证码不需永久保存，通常在很短的时间后就会失效</li> <li>分布式部署时，存在Session共享的问题</li></ul></li> <li>使用Redis存储登录凭证
<ul><li>处理每次请求时，都要查询用户的登录凭证，访问的频率非常高</li></ul></li> <li>使用Redis缓存用户信息
<ul><li>处理每次请求时，都要根据凭证查询用户信息，访问的频率非常高</li></ul></li></ul> <h3 id="kafka-构建tb级异步消息系统"><a href="#kafka-构建tb级异步消息系统" class="header-anchor">#</a> Kafka，构建TB级异步消息系统</h3> <h4 id="发送系统通知"><a href="#发送系统通知" class="header-anchor">#</a> 发送系统通知</h4> <ul><li>触发事件
<ul><li>评论后，发布通知</li> <li>点赞后，发布通知</li> <li>关注后，发布通知</li></ul></li> <li>处理事件
<ul><li>封装事件对象</li> <li>开发事件的生产者</li> <li>开发事件的消费者</li></ul></li> <li>业务逻辑
<ul><li>当点赞评论关注后，后台封装成一个事件向某一个用户发送消息(Producer)，在点赞评论关注时调用该功能，还得传入对应的帖子id，</li> <li>当消费者(Consumer)接收到消息后，将事件存储到Message表中，而被点赞用户登录后则能接收到系统通知，即查询到Message表中的数据</li></ul></li></ul> <h4 id="显示系统通知"><a href="#显示系统通知" class="header-anchor">#</a> 显示系统通知</h4> <ul><li>通知列表
<ul><li>显示评论、点赞、关注三种类型的通知</li></ul></li> <li>通知详情
<ul><li>分页显示某一类主题所包含的通知</li></ul></li> <li>未读消息
<ul><li>在页面头部显示所有的未读消息数量</li></ul></li></ul> <h3 id="开发平台搜索功能"><a href="#开发平台搜索功能" class="header-anchor">#</a> 开发平台搜索功能</h3> <ul><li>将Elasticsearch和实体类之间建立联系，在实体类中加入注解</li> <li>搜索服务
<ul><li>将帖子保存至 Elasticsearch 服务器</li> <li>从 Elasticsearch 服务器删除帖子</li> <li>从 Elasticsearch 服务器搜索帖子</li></ul></li> <li>发布事件
<ul><li>发布帖子时，将帖子异步的提交到 Elasticsearch 服务器</li> <li>增加评论时，将帖子异步的提交到 Elasticsearch 服务器</li> <li>在消费组件中增加一个方法，消费帖子发布事件</li></ul></li> <li>显示结果
<ul><li>在控制器中处理搜索请求，在HTML上显示搜索结果</li></ul></li></ul> <h3 id="项目优化"><a href="#项目优化" class="header-anchor">#</a> 项目优化</h3> <h4 id="权限控制"><a href="#权限控制" class="header-anchor">#</a> 权限控制</h4> <ul><li>登录检查
<ul><li>之前采用拦截器实现了登录检查，这是简单的权限管理方案，现在将其废弃</li></ul></li> <li>授权配置
<ul><li>对当前系统内包含的所有的请求，分配访问权限（普通用户、版主、管理员）</li></ul></li> <li>认证方案
<ul><li>绕过Security认证流程，采用系统原来的认证方案</li></ul></li> <li>CSRF配置
<ul><li>防止CSRF攻击的基本原理，以及表单、AJAX相关的配置</li></ul></li></ul> <h4 id="置顶、加精、删除"><a href="#置顶、加精、删除" class="header-anchor">#</a> 置顶、加精、删除</h4> <ul><li>功能实现
<ul><li>点击置顶，修改帖子的类型</li> <li>点击 “加精”、“删除”， 修改帖子的状态。</li></ul></li> <li>权限管理
<ul><li>版主可以执行“置顶”、“加精”操作</li> <li>管理员可以执行“删除”操作</li></ul></li> <li>按钮显示
<ul><li>版主可以看到“置顶”、“加精”按钮</li> <li>管理员可以看到“删除”按钮</li></ul></li></ul> <h4 id="网站数据统计"><a href="#网站数据统计" class="header-anchor">#</a> 网站数据统计</h4> <ul><li>UV (Unique Visitor)
<ul><li>独立访客，需通过用户IP排重统计数据</li> <li>每次访问都要进行统计</li> <li>HyperLogLog，性能好，且存储空间小</li></ul></li> <li>DAU (Daily Active User)
<ul><li>日活跃用户，需通过用户ID排重统计数据</li> <li>访问过一次，则认为其活跃</li> <li>Bitmap，性能好、且可以统计精确的结果</li></ul></li></ul> <h3 id="任务执行和调度"><a href="#任务执行和调度" class="header-anchor">#</a> 任务执行和调度</h3> <p>在浏览器发给服务器的请求中间会经过 Nginx ，来实现负载均衡</p> <ul><li>JDK 线程池(<strong>面试重点</strong>)
<ul><li>普通线程池：ExecutorService</li> <li>可执行定时任务的线程池：ScheduledExecutorService</li></ul></li> <li>Spring 线程池(<strong>面试重点</strong>)（不在分布式环境下的话推荐使用spring提供的）
<ul><li>Spring普通线程池：ThreadPoolTaskExecutor,有简化使用方式：注解方式：@Async</li> <li>Spring可执行定时任务的线程池：ThreadPoolTaskScheduler（没有解决分布式情况下冲突的问题）,也有简化使用方式：注解：@Scheduled</li></ul></li> <li>分布式定时任务
<ul><li>Spring Quartz：需要在数据库里存入一些信息（一些表）
<ul><li>核心组件：Scheduler接口（需要定义任务）、Job接口（定义一个任务）、JobDetail接口（用来配置Job）、Trigger接口（用来配置Job什么时候运行，以什么样频率执行任务）</li> <li>配置完后程序启动时Quartz会读取配置信息，存到数据库里(需配置properties文件，数据库里的表：<code>qrtz_job_details、qrtz_simple_trigger、qrtz_triggers、qrtz_scheduler_state、qrtz_locks</code>)，后面Quartz就直接读取数据库来执行任务，不需要重新配置</li></ul></li></ul></li></ul> <h3 id="热帖排行"><a href="#热帖排行" class="header-anchor">#</a> 热帖排行</h3> <ul><li>计算公式：log(精华分 + 评论数*10 + 点赞数*2 + 收藏数*2) + （发布时间 - 牛客纪元）</li> <li>因为没有收藏功能，所以可以忽略收藏数这个因素</li> <li>采用定时任务来实现，只处理分数变化的帖子，将分数变化的帖子存储到集合里，不用处理所有帖子</li> <li>用Redis作为缓存存储分数变化的帖子，将帖子存储到set里</li></ul> <h3 id="生成长图"><a href="#生成长图" class="header-anchor">#</a> 生成长图</h3> <ul><li>wkhtmltopdf：命令行的方式
<ul><li>wkhtmltopdf url file：模板内容生成pdf</li> <li>wkhtmltoimage url file：网页生成本地图片</li></ul></li> <li>java
<ul><li>Runtime.getRuntime().exec()</li></ul></li></ul> <h3 id="将文件上传至云服务器"><a href="#将文件上传至云服务器" class="header-anchor">#</a> 将文件上传至云服务器</h3> <ul><li>客户端上传
<ul><li>客户端将数据提交给云服务器，并等待其响应</li> <li>用户上传头像时，将表单数据提交给云服务器</li></ul></li> <li>服务器直传
<ul><li>应用服务器将数据直接提交给云服务器，并等待其响应</li> <li>分享时，服务端将自动生成的图片，直接提交给云服务器</li></ul></li></ul> <h3 id="优化网站的性能"><a href="#优化网站的性能" class="header-anchor">#</a> 优化网站的性能</h3> <ul><li>本地缓存
<ul><li>将数据缓存在应用服务器上，性能最好</li> <li>常用缓存工具：Ehcache、Guava、Caffeine等</li></ul></li> <li>分布式缓存
<ul><li>将数据缓存在 NoSQL 数据库上，跨服务器</li> <li>常用缓存工具：MemCache、Redis等</li></ul></li> <li>多级缓存
<ul><li>&gt; 一级缓存（本地缓存） &gt; 二级缓存（分布式缓存） &gt; DB</li> <li>避免缓存雪崩（缓存失效，大量请求直达DB），提高系统的可用性</li></ul></li> <li>Caffeine
<ul><li>核心接口：Cache, LoadingCache, AsyncLoadingCache</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-note/Java/Java框架/SpringSecurity.html" class="prev">
        Spring Security
      </a></span> <span class="next"><a href="/java-note/Java/校园信息交流平台项目/项目细节.html">
        项目细节
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/java-note/assets/js/app.4802240e.js" defer></script><script src="/java-note/assets/js/2.834e1286.js" defer></script><script src="/java-note/assets/js/1.56911593.js" defer></script><script src="/java-note/assets/js/48.4ae8f2d5.js" defer></script>
  </body>
</html>
